<form class="rmu-calc-wrapper" autocomplete="off">
  <div class="rmu-calc-pane">

    <fieldset class="rmu-calc-fieldset">
      <legend>Primary Skill</legend>
      <div class="form-group">
        <label>Skill</label>
        <div class="form-fields">
          <select class="rmu-primary-skill-select" name="primarySkillName">
            <option value="">Select Primary Skill...</option>
            {{#each primarySkillOptions}}
            <optgroup label="{{label}}">
              {{#each skills}}
              <option value="{{uuid}}" {{selected (eq uuid ../../primarySkillUuid)}}>
                {{name}} (Bonus: {{bonus}})
              </option>
              {{/each}}
            </optgroup>
            {{/each}}
          </select>
        </div>
      </div>
    </fieldset>

    <fieldset class="rmu-calc-fieldset">
      <legend>Participants</legend>
      <div class="rmu-participant-list" id="boost-skill-participants">
        <div class="rmu-participant-row rmu-participant-header">
          <span>Enabled</span>
          <span>Primary</span>
          <span>Participant</span>
          <span>Skill Bonus</span>
        </div>
        {{#each participants}}
        <div class="rmu-participant-row">
          <input type="checkbox" class="rmu-participant-enable" data-id="{{id}}" {{checked enabled}}/>
          <input type="radio" class="rmu-primary-actor-select" name="primaryActor" value="{{id}}" {{checked (eq id ../primaryActorId)}} {{disabled (not enabled)}}/>
          <label>{{name}}</label>
          <span class="rmu-participant-bonus">{{bonusForSelectedSkill}}</span>
        </div>
        {{/each}}
      </div>
      <div class="rmu-add-wrapper">
        <button type="button" class="rmu-add-participant">
          <i class="fas fa-plus"></i> Add Participant
        </button>
      </div>
    </fieldset>

    {{#if primaryActorId}}
    <fieldset class="rmu-calc-fieldset">
      <legend>Complementary Skills</legend>
      <div class="rmu-sub-fieldset">
        <legend>From Primary Participant</legend>
        <div class="rmu-dynamic-list">
          {{#each primaryActorSkills}}
          <div class="rmu-dynamic-row">
            <select class="rmu-primary-comp-skill" data-index="{{@index}}">
              <option value="">Select Skill...</option>
              {{#each ../primaryComplementOptions}}
              <optgroup label="{{label}}">
                {{#each skills}}
                <option value="{{uuid}}" {{selected (eq ../../uuid uuid)}}>
                  {{name}} (Ranks: {{ranks}})
                </option>
                {{/each}}
              </optgroup>
              {{/each}}
            </select>
            <button type="button" class="rmu-icon-button rmu-primary-comp-delete" data-index="{{@index}}" title="Remove Skill">
              <img src="modules/rmu-complementary-skills/assets/icon-trash.svg" width="14" height="14"/>
            </button>
          </div>
          {{/each}}
        </div>
        <button type="button" class="rmu-primary-comp-add">
          <i class="fas fa-plus"></i> Add Skill
        </button>
      </div>

      <div class="rmu-sub-fieldset">
        <legend>From Other Participants</legend>
        {{#each otherParticipants}}
        {{#if enabled}}
        <div class="form-group">
          <label>{{name}}</label>
          <div class="form-fields">
            <select class="rmu-other-comp-skill" data-id="{{id}}">
              <option value="">None</option>
              {{#each allSkillsGrouped}}
              <optgroup label="{{label}}">
                {{#each skills}}
                <option value="{{uuid}}" {{selected (eq (lookup ../../../otherActorSkills ../../id) uuid)}}>
                  {{name}} (Ranks: {{ranks}})
                </option>
                {{/each}}
              </optgroup>
              {{/each}}
            </select>
          </div>
        </div>
        {{/if}}
        {{/each}}
        {{#if (eq otherParticipants.length 0)}}
        <span class="rmu-notes">No other participants are enabled.</span>
        {{/if}}
      </div>
    </fieldset>

    <fieldset class="rmu-calc-fieldset">
      <legend>Calculation</legend>
      <div class="rmu-output-box">
        <div class="rmu-output-row">
          <span>Primary Skill Bonus:</span>
          <span class="rmu-output-value">+{{calculation.primaryBonus}}</span>
        </div>
        <div class="rmu-output-row">
          <span>Complementary Bonus:</span>
          <span class="rmu-output-value">+{{calculation.complementBonus}}</span>
        </div>
        <div class="rmu-output-row rmu-output-total">
          <span>Total Bonus:</span>
          <span class="rmu-output-value">+{{calculation.total}}</span>
        </div>

        {{#if calculation.breakdown}}
        <div class="rmu-output-breakdown">
          <span class="rmu-notes">Breakdown:</span>
          <ul>
            {{#each calculation.breakdown}}
            <li>
              <strong>+{{bonus}}</strong>
              (from {{name}} - {{ranks}} Ranks)
            </li>
            {{/each}}
          </ul>
        </div>
        {{/if}}
      </div>
    </fieldset>
    {{/if}}
  </div>
</form>

<footer class="rmu-calc-footer">
  <button type="button" class="rmu-send-chat">
    <i class="fas fa-comment-alt"></i> Send to Chat (GM)
  </button>
</footer>